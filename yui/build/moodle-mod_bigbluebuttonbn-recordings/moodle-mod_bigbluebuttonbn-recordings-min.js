YUI.add("moodle-mod_bigbluebuttonbn-recordings",function(e,t){M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.recordings={datasource:null,locale:"en",profilefeatures:{},datatable:{},init:function(t){this.datasource=new e.DataSource.Get({source:M.cfg.wwwroot+"/mod/bigbluebuttonbn/bbb_broker.php?"}),this.locale=t.locale,this.profilefeatures=t.profile_features,this.datatable.columns=t.columns,this.datatable.data=t.data,t.recordings_html===!1&&(this.profilefeatures.includes("all")||this.profilefeatures.includes("showrecordings"))&&this.datatable_init()},datatable_init:function(){var e={weekday:"long",year:"numeric",month:"long",day:"numeric"},t=this.datatable.columns,n=this.datatable.data;for(var r=0;r<n.length;r++){var i=new Date(n[r].date);n[r].date=i.toLocaleDateString(this.locale,e)}YUI({lang:this.locale}).use("datatable","datatable-sort","datatable-paginator","datatype-number",function(e){var r=(new e.DataTable({width:"1075px",columns:t,data:n,rowsPerPage:10,paginatorLocation:["header","footer"]})).render("#bigbluebuttonbn_yui_table");return r})},recording_action:function(e,t,n){var r=this.recording_element_payload(e);for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);if(!t){this.recording_action_perform(r);return}var s=new M.core.confirm({modal:!0,centered:!0,question:this.recording_confirmation_message(r.action,r.recordingid)});s.on("complete-yes",function(){this.recording_action_perform(r)},this)},recording_element_payload:function(t){var n=e.one(t),r=n.ancestor("div");return{action:n.getAttribute("data-action"),recordingid:r.getAttribute("data-recordingid"),meetingid:r.getAttribute("data-meetingid")}},recording_action_perform:function(e){M.mod_bigbluebuttonbn.recordings.recording_action_inprocess(e),M.mod_bigbluebuttonbn.broker.recording_action_perform(e)},recording_publish:function(e){var t={source:"published",goalstate:!0};this.recording_action(e,!1,t)},recording_unpublish:function(e){var t={source:"published",goalstate:!1};this.recording_action(e,!0,t)},recording_delete:function(e){var t={source:"status",goalstate:!1};this.recording_action(e,!0,t)},recording_import:function(e){var t={};this.recording_action(e,!0,t)},recording_update:function(t){console.info("Updating...");var n=e.one(t),r=n.ancestor("div"),i={target:r.getAttribute("data-target"),source:r.getAttribute("data-source"),goalstate:n.getAttribute("data-goalstate")};this.recording_action(t,!1,i)},recording_edit:function(t){var n=e.one(t),r=n.ancestor("div"),i=r.one("> span"),n=r.one("> a");i.hide(),n.hide();var s=e.Node.create('<input type="text" class="form-control"></input>');s.setAttribute("id",n.getAttribute("id")),s.setAttribute("value",i.getHTML()),s.setAttribute("onkeydown","M.mod_bigbluebuttonbn.recordings.recording_edit_keydown(this);"),r.append(s)},recording_edit_keydown:function(t){if(event.keyCode==13){var n=t.value,r=e.one(t),i=r.ancestor("div"),s=i.one("> span"),o=i.one("> a");setTimeout(function(){r.setAttribute("data-action","edit"),r.setAttribute("data-goalstate",n),M.mod_bigbluebuttonbn.recordings.recording_update(r.getDOMNode()),r.remove(),s.setHTML(n),s.show(),o.show()}(this),0)}},recording_confirmation_message:function(t,n){var r=M.util.get_string("view_recording_"+t+"_confirmation","bigbluebuttonbn");if(r==="undefined")return"";var i=e.one("#playbacks-"+n).get("dataset").imported==="true",s=M.util.get_string("view_recording","bigbluebuttonbn");i&&(s=M.util.get_string("view_recording_link","bigbluebuttonbn")),r=r.replace("{$a}",s);if(t==="publish"||t==="delete"){var o=e.one("#recording-link-"+t+"-"+n).get("dataset").links,u=M.util.get_string("view_recording_"+t+"_confirmation_warning_p","bigbluebuttonbn");o==1&&(u=M.util.get_string("view_recording_"+t+"_confirmation_warning_s","bigbluebuttonbn")),u=u.replace("{$a}",o)+". ",r=u+"\n\n"+r}return r},recording_action_inprocess:function(t){var n=t.action;typeof t.target!="undefined"&&(n+="-"+t.target);var r=e.one("img#recording-"+n+"-"+t.recordingid),i=M.util.get_string("view_recording_list_action_"+t.action,"bigbluebuttonbn");r.setAttribute("alt",i),r.setAttribute("title",i),r.setAttribute("data-src",r.getAttribute("src")),r.setAttribute("src",M.cfg.wwwroot+"/mod/bigbluebuttonbn/pix/processing16.gif");var s=e.one("a#recording-"+n+"-"+t.recordingid);s.setAttribute("data-onlcick",s.getAttribute("onclick")),s.setAttribute("onclick","")},recording_action_completed:function(t){var n=this.recording_processing_target(t);if(t.action=="delete"||t.action=="import")return this.recording_importdelete_completed(t);var r;if(t.action=="publish"||t.action=="unpublish")r=this.recording_publishunpublish_completed(t);var i=e.one("img#recording-"+n+"-"+t.recordingid),s=i.getAttribute("data-src"),o=e.one("a#recording-"+n+"-"+t.recordingid),u=o.getAttribute("data-onlcick");r=this.recording_processing_action(t);var a="show",f=M.util.get_string("view_recording_list_actionbar_publish","bigbluebuttonbn");e.one("#playbacks-"+t.recordingid).hide(),e.one("#preview-"+t.recordingid).hide(),t.action==="publish"&&(r="unpublish",a="hide",f=M.util.get_string("view_recording_list_actionbar_unpublish","bigbluebuttonbn"),e.one("#playbacks-"+t.recordingid).show(),e.one("#preview-"+t.recordingid).show()),i.setAttribute("id","recording-"+r.action+"-"+t.recordingid),o.setAttribute("id","recording-"+r.action+"-"+t.recordingid),o.setAttribute("data-action",r.action),i.setAttribute("src",s.substring(0,s.length-4)+a),i.setAttribute("alt",r.text),i.setAttribute("title",r.text),o.setAttribute("onclick",u.replace(t.action,r.action))},recording_importdelete_completed:function(t){e.one("#recording-td-"+t.recordingid).remove()},recording_publishunpublish_completed:function(t){e.one("#recording-td-"+t.recordingid).remove()},recording_processing_target:function(e){var t=e.action;return typeof e.target!="undefined"&&(t=e.target),t},recording_processing_action:function(e){},recording_action_failed:function(t){var n=new M.core.alert({title:M.util.get_string("error","moodle"),message:t.message}
);n.show();var r=e.one("img#recording-"+t.action+"-"+t.recordingid),i=e.one("a#recording-"+t.action+"-"+t.recordingid),s=M.util.get_string("view_recording_list_actionbar_unpublish","bigbluebuttonbn");t.action==="publish"&&(s=M.util.get_string("view_recording_list_actionbar_publish","bigbluebuttonbn")),r.setAttribute("id","recording-"+t.action+"-"+t.recordingid),i.setAttribute("id","recording-"+t.action+"-"+t.recordingid),i.setAttribute("data-action",t.action),r.setAttribute("src",r.getAttribute("data-src")),r.setAttribute("alt",s),r.setAttribute("title",s),i.setAttribute("onclick",i.getAttribute("data-onlcick"))},recording_delete_completed:function(t){e.one("#recording-td-"+t.recordingid).remove()}}},"@VERSION@",{requires:["base","node","datasource-get","datasource-jsonschema","datasource-polling","moodle-core-notification"]});
