YUI.add("moodle-mod_bigbluebuttonbn-recordings",function(e,t){M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.recordings={datasource:null,locale:"en",profilefeatures:{},datatable:{},init:function(t){this.datasource=new e.DataSource.Get({source:M.cfg.wwwroot+"/mod/bigbluebuttonbn/bbb_broker.php?"}),this.locale=t.locale,this.profilefeatures=t.profile_features,t.recordings_html===!1&&(this.profilefeatures.includes("all")||this.profilefeatures.includes("showrecordings"))&&(this.datatable.columns=t.columns,this.datatable.data=this.datatable_init_format_dates(t.data),this.datatable_init())},datatable_init_format_dates:function(e){for(var t=0;t<e.length;t++){var n=new Date(e[t].date);e[t].date=n.toLocaleDateString(this.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}return e},datatable_init:function(){var e=this.datatable.columns,t=this.datatable.data;YUI({lang:this.locale}).use("datatable","datatable-sort","datatable-paginator","datatype-number",function(n){var r=(new n.DataTable({width:"1075px",columns:e,data:t,rowsPerPage:10,paginatorLocation:["header","footer"]})).render("#bigbluebuttonbn_yui_table");return r})},recording_action:function(e,t,n){var r=this.recording_element_payload(e);r=Object.assign(r,n);if(!t){this.recording_action_perform(r);return}var i=new M.core.confirm({modal:!0,centered:!0,question:this.recording_confirmation_message(r.action,r.recordingid)});i.on("complete-yes",function(){this.recording_action_perform(r)},this)},recording_element_payload:function(t){var n=e.one(t),r=n.ancestor("div");return{action:n.getAttribute("data-action"),recordingid:r.getAttribute("data-recordingid"),meetingid:r.getAttribute("data-meetingid")}},recording_action_perform:function(e){M.mod_bigbluebuttonbn.recordings.recording_action_inprocess(e),M.mod_bigbluebuttonbn.broker.recording_action_perform(e)},recording_publish:function(e){var t={source:"published",goalstate:"true"};this.recording_action(e,!1,t)},recording_unpublish:function(e){var t={source:"published",goalstate:"false"};this.recording_action(e,!1,t)},recording_delete:function(e){var t={source:"status",goalstate:!1};this.recording_action(e,!0,t)},recording_import:function(e){var t={};this.recording_action(e,!0,t)},recording_update:function(t){var n=e.one(t),r=n.ancestor("div"),i={target:r.getAttribute("data-target"),source:r.getAttribute("data-source"),goalstate:n.getAttribute("data-goalstate")};this.recording_action(t,!1,i)},recording_edit:function(t){var n=e.one(t),r=n.ancestor("div"),i=r.one("> span");i.hide(),n.hide();var s=e.Node.create('<input type="text" class="form-control"></input>');s.setAttribute("id",n.getAttribute("id")),s.setAttribute("value",i.getHTML()),s.setAttribute("data-value",i.getHTML()),s.setAttribute("onkeydown","M.mod_bigbluebuttonbn.recordings.recording_edit_keydown(this);"),s.setAttribute("onfocusout","M.mod_bigbluebuttonbn.recordings.recording_edit_onfocusout(this);"),r.append(s)},recording_edit_keydown:function(e){if(event.keyCode==13){this.recording_edit_perform(e);return}event.keyCode==27&&this.recording_edit_onfocusout(e)},recording_edit_onfocusout:function(t){var n=e.one(t),r=n.ancestor("div");n.hide(),r.one("> span").show(),r.one("> a").show()},recording_edit_perform:function(t){var n=e.one(t),r=n.ancestor("div"),i=t.value;n.setAttribute("data-action","edit"),n.setAttribute("data-goalstate",i),M.mod_bigbluebuttonbn.recordings.recording_update(n.getDOMNode()),r.one("> span").setHTML(i);var s=r.one("> a");s.show(),s.focus()},recording_edit_completion:function(t){var n=e.one(t),r=n.ancestor("div"),i=r.one("> span");if(typeof i=="undefined")return;var s=r.one("> input");s.remove()},recording_edit_failover:function(t){var n=e.one(t),r=n.ancestor("div"),i=r.one("> span");if(typeof i=="undefined")return;var s=r.one("> input");i.setHTML(s.getAttribute("data-value")),s.remove()},recording_confirmation_message:function(t,n){var r=M.util.get_string("view_recording_"+t+"_confirmation","bigbluebuttonbn");if(typeof r=="undefined")return"";var i=M.util.get_string("view_recording","bigbluebuttonbn");e.one("#playbacks-"+n).get("dataset").imported==="true"&&(i=M.util.get_string("view_recording_link","bigbluebuttonbn")),r=r.replace("{$a}",i);if(t==="import")return r;var s=e.one("a#recording-"+t+"-"+n).get("dataset").links;if(s===0)return r;var o=M.util.get_string("view_recording_"+t+"_confirmation_warning_p","bigbluebuttonbn");return s==1&&(o=M.util.get_string("view_recording_"+t+"_confirmation_warning_s","bigbluebuttonbn")),o=o.replace("{$a}",s)+". ",o+"\n\n"+r},recording_action_inprocess:function(t){var n=this.recording_action_elementid(t.action,t.target),r=e.one("img#recording-"+n+"-"+t.recordingid),i=M.util.get_string("view_recording_list_action_"+t.action,"bigbluebuttonbn");r.setAttribute("alt",i),r.setAttribute("title",i),r.setAttribute("data-src",r.getAttribute("src")),r.setAttribute("src",M.cfg.wwwroot+"/mod/bigbluebuttonbn/pix/processing16.gif");var s=e.one("a#recording-"+n+"-"+t.recordingid);s.setAttribute("data-onclick",s.getAttribute("onclick")),s.setAttribute("onclick","")},recording_action_completion:function(t){if(t.action=="delete"||t.action=="import"){e.one("#recording-td-"+t.recordingid).remove();return}var n=this.recording_action_elementid(t.action,t.target),r=this.recording_action_aftercompletion(t.action),i=e.one("img#recording-"+n+"-"+t.recordingid),s=M.util.get_string("view_recording_list_actionbar_"+r,"bigbluebuttonbn"),o=this.recording_action_elementtag(r),u=i.getAttribute("data-src"),a=e.one("a#recording-"+n+"-"+t.recordingid),f=a.getAttribute("data-onclick"),l="recording-"+n+"-"+t.recordingid;if(r!==t.action){var c=t.action,h=new RegExp(c,"g");l=l.replace(h,r),f=f.replace(t.action,r),u=u.replace(this.recording_action_elementtag(t.action),o)}i.setAttribute("id",l),i.setAttribute("alt",s),i.setAttribute("title",s),i.setAttribute("src",u),i.removeAttribute("data-src"),a.setAttribute("id",l),a.setAttribute("data-action",r),a.setAttribute("onclick",f),a.removeAttribute
("data-onclick"),t.action==="edit",(t.action==="publish"||t.action==="unpublish")&&this.recording_publishunpublish_completion(t.recordingid,t.action)},recording_action_elementid:function(e,t){var n=e;return typeof t!="undefined"&&(n+="-"+t),n},recording_action_elementtag:function(e){var t={publish:"show",unpublish:"hide",protect:"lock",unprotect:"unlock",edit:"edit","import":"import","delete":"delete"};return t[e]},recording_action_aftercompletion:function(e){var t={publish:"unpublish",unpublish:"publish",protect:"unprotect",unprotect:"protect",edit:"edit","import":"import","delete":"delete"};return t[e]},recording_action_failover:function(t){var n=new M.core.alert({title:M.util.get_string("error","moodle"),message:t.message});n.show();var r=this.recording_action_elementid(t.action,t.target),i=e.one("img#recording-"+r+"-"+t.recordingid),s=M.util.get_string("view_recording_list_action_"+t.action,"bigbluebuttonbn");i.setAttribute("id","recording-"+r+"-"+t.recordingid),i.setAttribute("alt",s),i.setAttribute("title",s),i.setAttribute("src",i.getAttribute("data-src")),i.removeAttribute("data-src");var o=e.one("a#recording-"+r+"-"+t.recordingid);o.setAttribute("id","recording-"+r+"-"+t.recordingid),o.setAttribute("data-action",t.action),o.setAttribute("onclick",o.getAttribute("data-onclick")),o.removeAttribute("data-onclick"),t.action==="edit"&&this.recording_edit_failover(o.getDOMNode())},recording_publishunpublish_completion:function(t,n){var r=e.one("#playbacks-"+t),i=e.one("#preview-"+t);if(n=="unpublish"){r.hide(),i.hide();return}r.show(),i.show()}}},"@VERSION@",{requires:["base","node","datasource-get","datasource-jsonschema","datasource-polling","moodle-core-notification"]});
