YUI.add("moodle-mod_bigbluebuttonbn-rooms",function(t,n){M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.rooms={data_source:null,polling:null,bigbluebuttonbn:{},panel:null,init:function(e){console.info("init"),this.data_source=new t.DataSource.Get({source:M.cfg.wwwroot+"/mod/bigbluebuttonbn/bbb_broker.php?"}),this.bigbluebuttonbn=e,(this.bigbluebuttonbn.profile_features.includes("all")||this.bigbluebuttonbn.profile_features.includes("showroom"))&&this.init_room()},init_room:function(){console.info("init_room");if(this.bigbluebuttonbn.activity!=="open"){var e="Room ended;",n=[this.bigbluebuttonbn.locales.conference_ended];bigbluebuttonbn.activity!=="ended"&&(e="Room is not open",n.push(this.bigbluebuttonbn.opening),n.push(this.bigbluebuttonbn.closing)),console.info(e),t.DOM.addHTML(t.one("#status_bar"),M.mod_bigbluebuttonbn.view_init_status_bar(n));return}console.info("Room open"),this.init_room_open()},init_room_open:function(){console.info("init_room_open"),this.panel=new t.Panel({srcNode:"#panelContent",headerContent:this.bigbluebuttonbn.locales.modal_title,width:250,zIndex:5,centered:!0,modal:!0,visible:!1,render:!0,plugins:[t.Plugin.Drag]}),this.panel.addButton({value:this.bigbluebuttonbn.locales.modal_button,section:t.WidgetStdMod.FOOTER,action:function(e){e.preventDefault(),this.panel.hide();var n=t.one("#meeting_join_url"),r=t.one("#meeting_message"),i=t.one("#recording_name"),s=t.one("#recording_description"),o=t.one("#recording_tags"),u=i.get("value").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=s.get("value").replace(/</g,"&lt;").replace(/>/g,"&gt;"),f=o.get("value").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l=n.get("value")+"&name="+u+"&description="+a+"&tags="+f;M.mod_bigbluebuttonbn.broker.executeJoin(l,r.get("value")),i.set("value",""),s.set("value",""),o.set("value",""),n.set("value",""),r.set("value","")}}),this.update_room()},update_room:function(){console.info("update_room");var n=t.one("#status_bar"),r=t.one("#control_panel"),i=t.one("#join_button"),s=t.one("#end_button"),o="action=meeting_info";o+="&id="+this.bigbluebuttonbn.meetingid,o+="&bigbluebuttonbn="+this.bigbluebuttonbn.bigbluebuttonbnid,console.info(o),this.data_source.sendRequest({request:o,callback:{success:function(e){console.info("success"),t.DOM.addHTML(n,M.mod_bigbluebuttonbn.rooms.init_status_bar(e.data.status.message)),t.DOM.addHTML(r,M.mod_bigbluebuttonbn.rooms.init_control_panel(e.data)),typeof e.data.status.can_join!="undefined"&&t.DOM.addHTML(i,M.mod_bigbluebuttonbn.rooms.init_join_button(e.data.status)),typeof e.data.status.can_end!="undefined"&&e.data.status.can_end&&t.DOM.addHTML(s,this.init_end_button(e.data.status))},failure:function(){console.info("Could not retrieve data: "+e.error.message)}}})},init_status_bar:function(e){var n=t.DOM.create("<span>");if(e.constructor===Array)for(var r in e){if(!e.hasOwnProperty(r))continue;var i=t.DOM.create("<span>");t.DOM.setAttribute(i,"id","status_bar_span_span"),t.DOM.setText(i,e[r]),t.DOM.addHTML(n,i),t.DOM.addHTML(n,t.DOM.create("<br>"))}else t.DOM.setAttribute(n,"id","status_bar_span"),t.DOM.setText(n,e);return n},init_control_panel:function(e){var n=t.DOM.create("<div>");t.DOM.setAttribute(n,"id","control_panel_div");var r="";return e.running&&(r+=this.msg_started_at(e.info.startTime)+" ",r+=this.msg_attendees_in(e.info.moderatorCount,e.info.participantCount)),t.DOM.addHTML(n,r),n},msg_started_at:function(e){var t=parseInt(e)-parseInt(e)%1e3,n=new Date(t),r=n.getHours(),i=n.getMinutes();return M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.started_at+" <b>"+r+":"+(i<10?"0":"")+i+"</b>."},msg_attendees_in:function(e,t){if(typeof e=="undefined"&&typeof t=="undefined")return M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.session_no_users+".";var n=t-e,r=M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.session_has_users,i=M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.moderators;e==1&&(i=M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.moderator);var s=M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.viewers;return e==1&&(s=M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.viewer),t==1?n>0?r+" <b>1</b> "+s+".":r+" <b>1</b> "+i+".":r+" <b>"+e+"</b> "+i+" and <b>"+n+"</b> "+s+"."},init_join_button:function(e){var n=t.DOM.create("<input>");t.DOM.setAttribute(n,"id","join_button_input"),t.DOM.setAttribute(n,"type","button"),t.DOM.setAttribute(n,"value",e.join_button_text);if(e.can_join){var r="M.mod_bigbluebuttonbn.broker.join('";r+=e.join_url+"', '"+M.mod_bigbluebuttonbn.rooms.bigbluebuttonbn.locales.in_progress,r+="', "+e.can_tag+");",t.DOM.setAttribute(n,"onclick",r)}else t.DOM.setAttribute(n,"disabled",!0),M.mod_bigbluebuttonbn.broker.waitModerator(e.join_url);return n},init_end_button:function(e){var n=t.DOM.create("<input>");return t.DOM.setAttribute(n,"id","end_button_input"),t.DOM.setAttribute(n,"type","button"),t.DOM.setAttribute(n,"value",e.end_button_text),e.can_end&&t.DOM.setAttribute(n,"onclick","M.mod_bigbluebuttonbn.broker.endMeeting();"),n}}},"@VERSION@",{requires:["base","node","datasource-get","datasource-jsonschema","datasource-polling","moodle-core-notification"]});
